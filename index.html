<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="google-site-verification"
      content="U-GWwZOKUY-FqRJYQu4ealLEaLnFK4WTKgDI7SCbS3E"
    />
    <title>
      画像軽量: ウェブ画像を瞬時に最適化＆WebP/AVIF変換 - SEO・表示速度を向上
    </title>
    <meta
      name="description"
      content="画像軽量でウェブ画像を瞬時に最適化し、SEOパフォーマンスを向上させましょう。JPG/PNG圧縮、WebP/AVIF変換、リアルタイム比較、一括処理をブラウザ内で安全に実行！高速で簡単なウェブ画像ソリューション。"
    />
    <meta
      name="keywords"
      content="画像最適化, WebP変換, AVIF変換, 画像圧縮, ウェブサイト高速化, SEO画像, JPG圧縮, PNG圧縮, 画像軽量化, オンライン画像変換, 画像リサイズ"
    />

    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23FFD700' d='M11 15.5H7.5c-.83 0-1.5-.67-1.5-1.5V10c0-.83.67-1.5 1.5-1.5H11l-3.2-6.57c-.12-.25-.03-.55.22-.67.25-.12.55-.03.67.22L14.77 12H19c.55 0 1 .45 1 1s-.45 1-1 1h-4.23L12 18.5c-.12.25-.42.34-.67.22-.25-.12-.34-.42-.22-.67L11 15.5z'/%3E%3C/svg%3E"
      type="image/svg+xml"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&family=Roboto:wght@300;400;700&display=swap");

      :root {
        --primary-color: #5c8d89; /* Calming Teal-ish Green */
        --secondary-color: #e8a24b; /* Muted Persimmon/Gold */
        --background-color: #f8f8f8; /* Slightly off-white */
        --text-color: #333;
        --border-color: #ddd;
        --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      body {
        font-family: "Noto Sans JP", "Roboto", sans-serif;
        line-height: 1.6;
        color: var(--text-color);
        background-color: var(--background-color);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        box-sizing: border-box;
      }

      .container {
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: var(--box-shadow);
        width: 100%;
        max-width: 960px; /* Wider */
        margin-bottom: 20px;
        box-sizing: border-box;
      }

      h1,
      h2 {
        text-align: center;
        color: var(--primary-color);
        margin-bottom: 25px;
        font-weight: 700;
      }

      h1 {
        font-size: 2.8em;
        margin-top: 0;
      }

      h2 {
        font-size: 2em;
        color: var(--secondary-color);
        margin-top: 40px;
        margin-bottom: 20px;
      }

      p {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
        font-size: 1.1em;
      }

      .drop-zone {
        border: 3px dashed var(--primary-color);
        border-radius: 12px;
        padding: 40px 20px;
        text-align: center;
        cursor: pointer;
        font-size: 1.2em;
        color: #777;
        background-color: #f9f9f9;
        transition: background-color 0.3s ease, border-color 0.3s ease;
        margin-bottom: 30px;
      }

      .drop-zone.hover {
        background-color: #e0f7fa;
        border-color: var(--secondary-color);
      }

      .drop-zone input {
        display: none;
      }

      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .control-group {
        background: #fdfdfd;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      label {
        display: block;
        margin-bottom: 10px;
        font-weight: 600;
        color: var(--text-color);
      }

      select,
      input[type="range"] {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        box-sizing: border-box;
        font-size: 1em;
      }

      input[type="range"] {
        -webkit-appearance: none;
        height: 8px;
        background: #ddd;
        outline: none;
        opacity: 0.7;
        transition: opacity 0.2s;
      }

      input[type="range"]:hover {
        opacity: 1;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--primary-color);
        cursor: pointer;
        transition: background 0.3s ease;
      }

      input[type="range"]::-webkit-slider-thumb:hover {
        background: #47706d; /* Darker primary color on hover */
      }

      .button-group {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 30px;
        flex-wrap: wrap;
      }

      button {
        background-color: var(--primary-color);
        color: #fff;
        border: none;
        padding: 14px 30px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1em;
        font-weight: 600;
        transition: background-color 0.3s ease, transform 0.2s ease;
        min-width: 180px;
      }

      button:hover {
        background-color: #47706d; /* Darker primary color on hover */
        transform: translateY(-2px);
      }

      button:active {
        transform: translateY(0);
      }

      .clear-button {
        background-color: #e0e0e0;
        color: var(--text-color);
      }

      .clear-button:hover {
        background-color: #ccc;
      }

      #fileList {
        margin-top: 30px;
        border-top: 1px solid var(--border-color);
        padding-top: 20px;
      }

      .file-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px dashed #eee;
      }

      .file-item:last-child {
        border-bottom: none;
      }

      .file-info span {
        display: block;
        font-size: 0.95em;
      }

      .file-info .name {
        font-weight: 600;
        color: var(--primary-color);
      }

      .file-info .size {
        font-size: 0.85em;
        color: #777;
      }

      .file-actions button {
        background: none;
        border: none;
        color: #ff6b6b;
        cursor: pointer;
        font-size: 0.9em;
        padding: 5px 10px;
        margin-left: 10px;
        transition: color 0.3s ease;
        min-width: unset; /* Override button min-width */
      }

      .file-actions button:hover {
        color: #ff4500;
      }

      .output-section {
        margin-top: 40px;
        text-align: center;
      }

      .output-images {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .output-image-item {
        background: #fff;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        text-align: center;
        padding-bottom: 15px;
      }

      .output-image-item img {
        max-width: 100%;
        height: auto;
        display: block;
        margin-bottom: 10px;
      }

      .output-image-item .filename {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--primary-color);
      }

      .output-image-item .size-info {
        font-size: 0.9em;
        color: #777;
        margin-bottom: 10px;
      }

      .output-image-item .size-info strong {
        color: #e8a24b; /* Use secondary color for emphasis */
      }

      .output-image-item .download-button {
        background-color: var(--secondary-color);
        color: #fff;
        padding: 8px 15px;
        border-radius: 5px;
        text-decoration: none;
        font-size: 0.9em;
        transition: background-color 0.3s ease;
      }

      .output-image-item .download-button:hover {
        background-color: #cc8a3c; /* Darker secondary color on hover */
      }

      #compareSliderContainer {
        margin-top: 30px;
        display: none; /* Hidden initially */
        background-color: #fdfdfd;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        text-align: center;
      }

      #compareSlider {
        position: relative;
        width: 100%;
        height: 300px; /* Comparison image height */
        overflow: hidden;
        border: 1px solid #ccc;
        margin: 20px auto;
        cursor: ew-resize;
        background-color: #f0f0f0; /* Loading background */
        display: flex;
        align-items: center;
        justify-content: center;
        font-style: italic;
        color: #999;
      }

      #compareSlider img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: contain; /* Maintain image aspect ratio */
        pointer-events: none; /* Do not interfere with slider handle events */
      }

      #compareSlider #beforeImage {
        z-index: 1;
      }

      #compareSlider #afterImage {
        z-index: 2;
        clip-path: inset(0 0 0 50%); /* Initially show only the right half */
      }

      #compareSlider .slider-handle {
        position: absolute;
        left: 50%;
        top: 0;
        bottom: 0;
        width: 4px;
        background: var(--primary-color);
        cursor: ew-resize;
        z-index: 3;
        transform: translateX(-50%);
      }
      #compareSlider .slider-handle::before,
      #compareSlider .slider-handle::after {
        content: "";
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--primary-color);
        border: 2px solid #fff;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }
      #compareSlider .slider-handle::before {
        left: -10px;
      }
      #compareSlider .slider-handle::after {
        right: -10px;
      }
      #compareSlider .comparison-info {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.8em;
        z-index: 4;
        white-space: nowrap;
      }

      footer {
        margin-top: 40px;
        text-align: center;
        font-size: 0.85em;
        color: #777;
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }
        h1 {
          font-size: 2.2em;
        }
        h2 {
          font-size: 1.6em;
        }
        p {
          font-size: 1em;
        }
        .drop-zone {
          padding: 30px 15px;
          font-size: 1em;
        }
        .controls {
          grid-template-columns: 1fr;
        }
        button {
          padding: 12px 20px;
          font-size: 1em;
          width: 100%;
          max-width: 280px; /* Prevent buttons from becoming too large on mobile */
        }
        .button-group {
          flex-direction: column;
          gap: 15px;
        }
        .output-images {
          grid-template-columns: 1fr;
        }
        #compareSlider {
          height: 200px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>
        <span style="color: var(--primary-color)">画像</span
        ><span style="color: var(--secondary-color)">軽量</span>
      </h1>
      <p>
        ウェブサイトの表示速度を最大化し、SEOを改善しましょう。画像を瞬時に圧縮してWebP/AVIFに変換します！
      </p>

      <div class="drop-zone" id="dropZone">
        画像をここにドラッグするか、<br />
        クリックして選択（複数ファイル対応）
        <input
          type="file"
          id="imageInput"
          accept="image/jpeg, image/png, image/webp, image/avif"
          multiple
        />
      </div>

      <div id="fileList"></div>

      <div class="controls">
        <div class="control-group">
          <label for="outputFormat">出力形式:</label>
          <select id="outputFormat">
            <option value="original">元の形式を維持（圧縮のみ）</option>
            <option value="webp">WebP（最新のウェブ最適化）</option>
            <option value="avif">AVIF（次世代画像フォーマット）</option>
            <option value="jpeg">JPEG（圧縮）</option>
            <option value="png">PNG（圧縮）</option>
          </select>
        </div>
        <div class="control-group">
          <label for="quality"
            >圧縮品質: <span id="qualityValue">80</span>%</label
          >
          <input type="range" id="quality" min="1" max="100" value="80" />
        </div>
      </div>

      <div class="button-group">
        <button id="processBtn">画像最適化を開始</button>
        <button id="clearBtn" class="clear-button">全てクリア</button>
      </div>

      <div id="compareSliderContainer">
        <h2>圧縮/変換 前後比較</h2>
        <div id="compareSlider">
          <img id="beforeImage" alt="Original Image" />
          <img id="afterImage" alt="Optimized Image" />
          <div class="slider-handle"></div>
          <div class="comparison-info" id="comparisonInfo"></div>
        </div>
        <p style="font-size: 0.9em; color: #777; margin-top: 10px">
          スライダーを左右に動かして、圧縮/変換前後の画質とファイルサイズを比較できます。
        </p>
      </div>

      <div class="output-section">
        <h2>最適化された画像</h2>
        <div id="outputImages" class="output-images">
          <p style="color: #888">最適化された画像がここに表示されます。</p>
        </div>
      </div>
    </div>

    <footer>
      &copy; 2025 画像軽量. All rights reserved. |
      <a href="#" style="color: var(--primary-color)">プライバシーポリシー</a>
    </footer>

    <script>
      const dropZone = document.getElementById("dropZone");
      const imageInput = document.getElementById("imageInput");
      const fileListDiv = document.getElementById("fileList");
      const outputFormatSelect = document.getElementById("outputFormat");
      const qualityRange = document.getElementById("quality");
      const qualityValueSpan = document.getElementById("qualityValue");
      const processBtn = document.getElementById("processBtn");
      const clearBtn = document.getElementById("clearBtn");
      const outputImagesDiv = document.getElementById("outputImages");
      const compareSliderContainer = document.getElementById(
        "compareSliderContainer"
      );
      const compareSlider = document.getElementById("compareSlider");
      const beforeImage = document.getElementById("beforeImage");
      const afterImage = document.getElementById("afterImage");
      const sliderHandle = compareSlider.querySelector(".slider-handle");
      const comparisonInfo = document.getElementById("comparisonInfo");

      let selectedFiles = [];
      let processingQueue = [];
      let currentComparisonImage = null;

      // --- ローカルストレージに基づいた設定の保存と読み込み ---
      function saveSettings() {
        localStorage.setItem(
          "imageOptiSettings",
          JSON.stringify({
            outputFormat: outputFormatSelect.value,
            quality: qualityRange.value,
          })
        );
      }

      function loadSettings() {
        const settings = JSON.parse(localStorage.getItem("imageOptiSettings"));
        if (settings) {
          outputFormatSelect.value = settings.outputFormat || "original";
          qualityRange.value = settings.quality || 80;
          qualityValueSpan.textContent = settings.quality || 80;
        }
      }

      // --- 画像圧縮/変換の主要ロジック ---
      function processImage(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = (event) => {
            const img = new Image();
            img.src = event.target.result;

            img.onload = () => {
              const canvas = document.createElement("canvas");
              const ctx = canvas.getContext("2d");

              // 元画像のサイズ
              const originalWidth = img.naturalWidth;
              const originalHeight = img.naturalHeight;

              canvas.width = originalWidth;
              canvas.height = originalHeight;
              ctx.drawImage(img, 0, 0, originalWidth, originalHeight);

              const format = outputFormatSelect.value;
              const quality = parseFloat(qualityRange.value) / 100;
              let mimeType = "image/jpeg"; // デフォルト
              let extension = "jpg";

              switch (format) {
                case "webp":
                  mimeType = "image/webp";
                  extension = "webp";
                  break;
                case "avif":
                  mimeType = "image/avif";
                  extension = "avif";
                  break;
                case "png":
                  mimeType = "image/png";
                  extension = "png";
                  break;
                case "jpeg":
                case "original": // 元がJPEGならJPEG、そうでなければPNG（ブラウザがサポートする形式に変換）
                  mimeType =
                    file.type === "image/jpeg" ? "image/jpeg" : "image/png";
                  extension = file.type === "image/jpeg" ? "jpg" : "png";
                  break;
              }

              // toBlobは非同期関数
              canvas.toBlob(
                (blob) => {
                  if (blob) {
                    const optimizedFilename = `${file.name
                      .split(".")
                      .slice(0, -1)
                      .join(".")}_optimized.${extension}`;
                    resolve({
                      originalFile: file,
                      optimizedBlob: blob,
                      optimizedFilename: optimizedFilename,
                      originalSrc: img.src, // 元画像のデータURL
                    });
                  } else {
                    reject(
                      new Error(
                        "Blobの作成に失敗しました。ブラウザがこの形式をサポートしていない可能性があります。"
                      )
                    );
                  }
                },
                mimeType,
                quality
              );
            };
            img.onerror = () =>
              reject(new Error("画像の読み込みに失敗しました。"));
          };
          reader.onerror = () =>
            reject(new Error("ファイルの読み込みに失敗しました。"));
        });
      }

      // --- UI更新とイベントハンドラ ---

      // ファイルのドラッグ＆ドロップと選択処理
      function handleFiles(files) {
        Array.from(files).forEach((file) => {
          if (file.type.startsWith("image/")) {
            selectedFiles.push(file);
          } else {
            alert(
              `${file.name}は画像ファイルではありません。画像ファイルのみ追加してください。`
            );
          }
        });
        renderFileList();
      }

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("hover");
      });

      dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("hover");
      });

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("hover");
        handleFiles(e.dataTransfer.files);
      });

      dropZone.addEventListener("click", () => {
        imageInput.click();
      });

      imageInput.addEventListener("change", (e) => {
        handleFiles(e.target.files);
        e.target.value = ""; // 同じファイルを再度選択できるようにリセット
      });

      // ファイルリストの表示
      function renderFileList() {
        fileListDiv.innerHTML = "";
        if (selectedFiles.length === 0) {
          fileListDiv.innerHTML = `<p style="text-align: center; color: #888;">まだ画像が選択されていません。</p>`;
          return;
        }
        selectedFiles.forEach((file, index) => {
          const fileItem = document.createElement("div");
          fileItem.className = "file-item";
          fileItem.innerHTML = `
                        <div class="file-info">
                            <span class="name">${file.name}</span>
                            <span class="size">${(
                              file.size /
                              1024 /
                              1024
                            ).toFixed(2)} MB</span>
                        </div>
                        <div class="file-actions">
                            <button data-index="${index}" class="remove-file-btn">削除</button>
                        </div>
                    `;
          fileListDiv.appendChild(fileItem);
        });

        document.querySelectorAll(".remove-file-btn").forEach((button) => {
          button.addEventListener("click", (e) => {
            const indexToRemove = parseInt(e.target.dataset.index);
            selectedFiles.splice(indexToRemove, 1);
            renderFileList();
          });
        });
      }

      // 圧縮品質値の表示
      qualityRange.addEventListener("input", () => {
        qualityValueSpan.textContent = qualityRange.value;
        saveSettings(); // 設定変更時に保存
      });
      outputFormatSelect.addEventListener("change", saveSettings); // 形式変更時に保存

      // 画像処理の開始
      processBtn.addEventListener("click", async () => {
        if (selectedFiles.length === 0) {
          alert("まず画像をアップロードしてください。");
          return;
        }

        outputImagesDiv.innerHTML = `<p style="text-align: center; color: #888;">画像を処理中です。しばらくお待ちください...</p>`;
        compareSliderContainer.style.display = "none"; // 新しい処理開始時に比較スライダーを非表示

        processingQueue = selectedFiles.map((file) => processImage(file));
        let firstProcessedImage = null;

        try {
          const results = await Promise.all(processingQueue);
          outputImagesDiv.innerHTML = ""; // 既存のメッセージを削除
          results.forEach((result, index) => {
            const outputItem = document.createElement("div");
            outputItem.className = "output-image-item";

            const optimizedBlobUrl = URL.createObjectURL(result.optimizedBlob);

            outputItem.innerHTML = `
                            <img src="${optimizedBlobUrl}" alt="${
              result.optimizedFilename
            }" loading="lazy">
                            <div class="filename">${
                              result.optimizedFilename
                            }</div>
                            <div class="size-info">
                                元: ${(result.originalFile.size / 1024).toFixed(
                                  2
                                )} KB <br>
                                最適化: <strong>${(
                                  result.optimizedBlob.size / 1024
                                ).toFixed(2)} KB</strong>
                                (${(
                                  100 -
                                  (result.optimizedBlob.size /
                                    result.originalFile.size) *
                                    100
                                ).toFixed(1)}%削減)
                            </div>
                            <a href="${optimizedBlobUrl}" download="${
              result.optimizedFilename
            }" class="download-button">ダウンロード</a>
                            <button class="compare-button" data-index="${index}">比較</button>
                        `;
            outputImagesDiv.appendChild(outputItem);

            // 最初の処理済み画像を比較スライダーにロード
            if (index === 0) {
              firstProcessedImage = result;
            }
          });

          if (firstProcessedImage) {
            showComparison(
              firstProcessedImage.originalSrc,
              URL.createObjectURL(firstProcessedImage.optimizedBlob),
              firstProcessedImage.originalFile.size,
              firstProcessedImage.optimizedBlob.size
            );
          }

          alert("全ての画像が正常に最適化されました！");

          // 比較ボタンにイベントリスナーを追加
          document.querySelectorAll(".compare-button").forEach((button) => {
            button.addEventListener("click", (e) => {
              const index = parseInt(e.target.dataset.index);
              const result = results[index];
              showComparison(
                result.originalSrc,
                URL.createObjectURL(result.optimizedBlob),
                result.originalFile.size,
                result.optimizedBlob.size
              );
            });
          });
        } catch (error) {
          outputImagesDiv.innerHTML = `<p style="color: red; text-align: center;">エラーが発生しました: ${error.message}。サポートされていないファイル形式の可能性があります。</p>`;
          console.error("画像処理中にエラー:", error);
          alert(`画像処理中にエラーが発生しました: ${error.message}`);
        } finally {
          // 処理完了後にURLを解放 (メモリ管理)
          // results配列のoptimizedBlobUrlは、後で不要になったら解放する必要があります。
          // ここではダウンロード機能のために保持し、ページが閉じられたときに自動的に解放されるようにします。
        }
      });

      // 全てクリア
      clearBtn.addEventListener("click", () => {
        selectedFiles = [];
        processingQueue = [];
        renderFileList();
        outputImagesDiv.innerHTML = `<p style="color:#888;">最適化された画像がここに表示されます。</p>`;
        compareSliderContainer.style.display = "none";
        alert("全ての画像と結果がクリアされました。");
      });

      // --- 画像比較スライダー機能 ---
      function showComparison(
        originalSrc,
        optimizedSrc,
        originalSize,
        optimizedSize
      ) {
        beforeImage.src = originalSrc;
        afterImage.src = optimizedSrc;
        compareSliderContainer.style.display = "block";

        const originalKb = (originalSize / 1024).toFixed(2);
        const optimizedKb = (optimizedSize / 1024).toFixed(2);
        const reduction = (100 - (optimizedSize / originalSize) * 100).toFixed(
          1
        );
        comparisonInfo.textContent = `元: ${originalKb} KB | 最適化: ${optimizedKb} KB (${reduction}%削減)`;

        // スライダーの初期化
        const handle = compareSlider.querySelector(".slider-handle");
        let isDragging = false;

        function moveSlider(e) {
          const rect = compareSlider.getBoundingClientRect();
          let x = (e.clientX || e.touches[0].clientX) - rect.left;
          if (x < 0) x = 0;
          if (x > rect.width) x = rect.width;

          const percentage = (x / rect.width) * 100;
          handle.style.left = `${percentage}%`;
          afterImage.style.clipPath = `inset(0 0 0 ${percentage}%)`;
        }

        // マウスイベント
        handle.onmousedown = (e) => {
          isDragging = true;
          compareSlider.style.cursor = "ew-resize";
        };
        compareSlider.onmousemove = (e) => {
          if (isDragging) {
            moveSlider(e);
          }
        };
        compareSlider.onmouseup = () => {
          isDragging = false;
          compareSlider.style.cursor = "ew-resize";
        };
        compareSlider.onmouseleave = () => {
          // スライダー領域からマウスが離れた場合もドラッグを停止
          if (isDragging) {
            isDragging = false;
            compareSlider.style.cursor = "grab"; // デフォルトのカーソルに変更
          }
        };

        // タッチイベント (モバイル対応)
        handle.ontouchstart = (e) => {
          isDragging = true;
        };
        compareSlider.ontouchmove = (e) => {
          if (isDragging) {
            e.preventDefault(); // スクロール防止
            moveSlider(e);
          }
        };
        compareSlider.ontouchend = () => {
          isDragging = false;
        };

        // 初期位置の設定 (中央)
        handle.style.left = "50%";
        afterImage.style.clipPath = "inset(0 0 0 50%)";
      }

      // 初回ロード時
      window.addEventListener("load", () => {
        loadSettings();
        renderFileList(); // 初期ファイルリスト (空)
      });
    </script>
  </body>
</html>
